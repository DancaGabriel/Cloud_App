<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rate de Schimb Valutar</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <h1>Rate de Schimb Valutar</h1>
    <p>Apasă butonul pentru a vedea cele mai recente rate de schimb pentru USD.</p>

    <button id="fetchRatesBtn">Actualizează Ratele</button>

    <div id="ratesContainer">
        <p class="placeholder">Datele despre ratele de schimb vor apărea aici...</p>
    </div>

    <script>
        document.getElementById('fetchRatesBtn').addEventListener('click', function() {
            const ratesContainer = document.getElementById('ratesContainer');
            ratesContainer.innerHTML = '<p class="loading">Se încarcă datele...</p>'; // Feedback pentru utilizator

            fetch('/get-exchange-rates')
                .then(response => {
                    if (!response.ok) {
                        // If the server response is not OK, try to parse the error from JSON
                        return response.json().then(errData => {
                            throw new Error(errData.error || `Eroare HTTP: ${response.status}`);
                        });
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.error) {
                        // Handle errors returned by our Flask endpoint
                        ratesContainer.innerHTML = `<p class="error">Eroare: ${data.error}</p>`;
                        if(data.details && data.details['error-type'] === 'invalid-key') {
                            ratesContainer.innerHTML += `<p class="error-detail">Verifică dacă API Key-ul este corect și activ.</p>`;
                        } else if (data.details && data.details['error-type'] === 'unsupported-code') {
                            ratesContainer.innerHTML += `<p class="error-detail">Codul valutar de bază nu este suportat de API.</p>`;
                        }
                        console.error("API Error details:", data.details || data);
                    } else if (data.rates) {
                        let content = `<h2>Rate de schimb pentru ${data.base_code}</h2>`;
                        content += `<p class="update-time">Ultima actualizare: ${data.last_update || 'N/A'}</p>`;
                        content += '<ul>';
                        // Afișăm câteva valute de interes, de exemplu
                        const targetCurrencies = ['EUR', 'RON', 'GBP', 'JPY', 'CAD', 'AUD'];
                        for (const currency of targetCurrencies) {
                            if (data.rates[currency]) {
                                content += `<li>1 ${data.base_code} = ${data.rates[currency].toFixed(4)} ${currency}</li>`;
                            }
                        }
                        // Adăugăm și alte rate dacă dorim
                        content += '</ul>';
                        // Pentru a afișa toate ratele, decomentează următoarele linii:
                        /*
                        content += '<h3>Toate Ratele:</h3><ul class="all-rates">';
                        for (const currency in data.rates) {
                            content += `<li>1 ${data.base_code} = ${data.rates[currency].toFixed(4)} ${currency}</li>`;
                        }
                        content += '</ul>';
                        */
                        ratesContainer.innerHTML = content;
                    } else {
                        ratesContainer.innerHTML = '<p class="error">Nu s-au primit datele așteptate de la server.</p>';
                    }
                })
                .catch(error => {
                    console.error('Eroare la fetch:', error);
                    ratesContainer.innerHTML = `<p class="error">A apărut o eroare la preluarea datelor: ${error.message}. Verifică consola pentru detalii.</p>`;
                });
        });
    </script>
</body>
</html>